<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Guid - Short Video App</title>
    <!-- Подключение Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Подключение иконок Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* * ===================================================================
         * Стилизация с использованием переменных темы Telegram
         * ===================================================================
         * Этот CSS использует переменные, предоставляемые Telegram SDK.
         * Это позволяет приложению автоматически адаптироваться к теме
         * пользователя в Telegram (светлая, темная, кастомная).
         * Например, var(--tg-theme-bg-color) будет цветом фона,
         * а var(--tg-theme-text-color) - цветом текста.
        */
        :root {
            /* Основные цвета из темы Telegram */
            --tg-bg: var(--tg-theme-bg-color, #000000);
            --tg-text: var(--tg-theme-text-color, #ffffff);
            --tg-hint: var(--tg-theme-hint-color, #aaaaaa);
            --tg-link: var(--tg-theme-link-color, #1c9eff);
            --tg-button: var(--tg-theme-button-color, #1c9eff);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --tg-secondary-bg: var(--tg-theme-secondary-bg-color, #111111);
            
            /* Дополнительные цвета для акцентов */
            --accent-red: #ff3b30;
            --border-radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent; /* Убирает подсветку при нажатии на мобильных */
        }
        
        body {
            background-color: var(--tg-bg);
            color: var(--tg-text);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* Общие стили для всех страниц */
        .page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            overflow-y: auto;
            padding-bottom: 60px; /* Отступ для нижней навигации */
            opacity: 0;
            transform: scale(0.98);
            transition: opacity 0.3s ease, transform 0.3s ease;
            background-color: var(--tg-bg);
        }
        
        .page.active {
            display: block;
            opacity: 1;
            transform: scale(1);
        }
        
        /* Стили для главной страницы с видео */
        #home-page {
            background-color: #000; /* Всегда черный фон для лучшего просмотра видео */
        }
        
        .video-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .video-wrapper {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        .video-wrapper.active { display: block; z-index: 2; transform: translateY(0); }
        .video-wrapper.next { display: block; z-index: 1; transform: translateY(100%); }
        .video-wrapper.prev { display: block; z-index: 1; transform: translateY(-100%); }
        
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #000;
        }
        
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0) 40%);
            pointer-events: none; /* Позволяет кликам проходить сквозь оверлей */
        }

        .video-info {
            position: absolute;
            bottom: 75px; /* Отступ от навигации */
            left: 15px;
            z-index: 10;
            max-width: 70%;
            color: #fff;
        }
        
        .username { font-weight: bold; font-size: 16px; margin-bottom: 5px; }
        .description { font-size: 14px; margin-bottom: 10px; line-height: 1.4; }
        .hashtags { font-size: 14px; font-weight: 500; color: #fff; }
        
        .right-sidebar {
            position: absolute;
            right: 15px;
            bottom: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
            color: #fff;
        }
        
        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #fff;
            margin-bottom: 25px;
            background-color: var(--tg-secondary-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
        }
        
        .follow-button {
            position: absolute;
            bottom: -10px;
            background-color: var(--accent-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #000;
        }
        
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .action-icon {
            font-size: 30px;
            margin-bottom: 5px;
            transition: transform 0.2s ease;
        }
        .action-icon.liked { color: var(--accent-red); }
        .action-button:active .action-icon { transform: scale(0.9); }
        .action-count { font-size: 13px; font-weight: 500; }
        
        /* Стили для остальных страниц (Поиск, Создание, Сообщения, Профиль) */
        .header {
            padding: 15px;
            font-size: 20px;
            font-weight: bold;
            position: sticky;
            top: 0;
            background-color: var(--tg-bg);
            z-index: 10;
            border-bottom: 1px solid var(--tg-secondary-bg);
        }

        .search-bar {
            display: flex;
            padding: 15px;
            position: sticky;
            top: 0;
            background-color: var(--tg-bg);
            z-index: 11;
        }
        
        .search-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            border: none;
            background-color: var(--tg-secondary-bg);
            color: var(--tg-text);
            font-size: 16px;
        }
        .search-input::placeholder { color: var(--tg-hint); }

        .section-title {
            font-size: 18px;
            margin: 20px 15px 15px;
            font-weight: bold;
        }

        .profile-header {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--tg-secondary-bg);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            border: 3px solid var(--tg-link);
        }
        
        .profile-name { font-size: 22px; font-weight: bold; margin-bottom: 5px; }
        .profile-username { font-size: 16px; color: var(--tg-hint); margin-bottom: 15px; }
        
        .profile-stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
            padding: 0 20px;
        }
        
        .profile-stat { text-align: center; }
        .stat-value { font-size: 18px; font-weight: bold; }
        .stat-label { font-size: 12px; color: var(--tg-hint); }
        
        .profile-actions {
            display: flex;
            gap: 10px;
            width: 100%;
            padding: 0 15px;
            margin-bottom: 20px;
        }
        
        .profile-button {
            flex: 1;
            padding: 12px;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: opacity 0.2s ease;
        }
        .profile-button:active { opacity: 0.8; }
        
        .profile-button-primary {
            background-color: var(--tg-button);
            color: var(--tg-button-text);
        }
        
        .profile-button-secondary {
            background-color: var(--tg-secondary-bg);
            color: var(--tg-text);
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid var(--tg-secondary-bg);
            position: sticky;
            top: 0;
            background-color: var(--tg-bg);
            z-index: 10;
        }
        
        .profile-tab {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-size: 16px;
            position: relative;
            cursor: pointer;
            color: var(--tg-hint);
        }
        
        .profile-tab.active {
            color: var(--tg-text);
            font-weight: bold;
        }
        
        .profile-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 25%;
            width: 50%;
            height: 3px;
            background-color: var(--tg-link);
            border-radius: 3px 3px 0 0;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            padding: 2px;
        }
        
        .grid-item {
            aspect-ratio: 9/16;
            background-color: var(--tg-secondary-bg);
            position: relative;
            cursor: pointer;
        }
        
        .grid-item-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .inbox-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 60vh;
            text-align: center;
            padding: 20px;
            color: var(--tg-hint);
        }
        .inbox-empty-icon { font-size: 50px; margin-bottom: 20px; }
        .inbox-empty-text { font-size: 16px; margin-bottom: 15px; }

        /* Нижняя навигация */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: var(--tg-bg);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            border-top: 1px solid var(--tg-secondary-bg);
        }
        
        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--tg-hint);
            font-size: 10px;
            cursor: pointer;
            padding: 5px;
            flex: 1;
            transition: color 0.2s ease;
        }
        
        .nav-icon { font-size: 24px; margin-bottom: 3px; }
        
        .nav-button.active {
            color: var(--tg-text);
            font-weight: bold;
        }
        
        .create-nav-button {
            background: var(--tg-button);
            width: 45px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tg-button-text);
            font-size: 22px;
        }

        /* Загрузчик и сообщения */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--tg-secondary-bg);
            border-radius: 50%;
            border-top-color: var(--tg-link);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
    </style>
</head>
<body>
    <!-- Главная страница (Лента видео) -->
    <div id="home-page" class="page active">
        <div class="video-container" id="video-container">
            <div class="loading-indicator">
                <div class="spinner"></div>
            </div>
        </div>
    </div>
    
    <!-- Страница поиска -->
    <div id="discover-page" class="page">
        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Поиск">
        </div>
        <!-- Здесь будет контент для поиска -->
    </div>
    
    <!-- Страница создания -->
    <div id="create-page" class="page">
        <div class="header">Создать</div>
        <!-- Здесь будет контент для создания видео -->
    </div>
    
    <!-- Страница сообщений -->
    <div id="inbox-page" class="page">
        <div class="header">Входящие</div>
        <div class="inbox-empty">
            <div class="inbox-empty-icon"><i class="far fa-paper-plane"></i></div>
            <div class="inbox-empty-text">Все сообщения от друзей появятся здесь</div>
        </div>
    </div>
    
    <!-- Страница профиля -->
    <div id="profile-page" class="page">
        <div class="profile-header">
            <div class="profile-avatar"></div>
            <div class="profile-name"></div>
            <div class="profile-username"></div>
            
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="stat-value">1,234</div>
                    <div class="stat-label">Подписки</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value">5.7M</div>
                    <div class="stat-label">Подписчики</div>
                </div>
                <div class="profile-stat">
                    <div class="stat-value">124.5M</div>
                    <div class="stat-label">Лайки</div>
                </div>
            </div>
            
            <div class="profile-actions">
                <div class="profile-button profile-button-secondary">Изменить профиль</div>
            </div>
        </div>
        
        <div class="profile-tabs">
            <div class="profile-tab active"><i class="fas fa-th"></i></div>
            <div class="profile-tab"><i class="far fa-heart"></i></div>
            <div class="profile-tab"><i class="far fa-bookmark"></i></div>
        </div>
        
        <div class="content-grid" id="profile-videos-grid">
            <!-- Миниатюры видео будут добавлены сюда -->
        </div>
    </div>
    
    <!-- Нижняя навигация -->
    <div class="bottom-nav">
        <div class="nav-button active" data-page="home-page">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <div>Главная</div>
        </div>
        <div class="nav-button" data-page="discover-page">
            <div class="nav-icon"><i class="fas fa-search"></i></div>
            <div>Интересное</div>
        </div>
        <div class="nav-button create-nav-button" data-page="create-page">
            <i class="fas fa-plus"></i>
        </div>
        <div class="nav-button" data-page="inbox-page">
            <div class="nav-icon"><i class="far fa-paper-plane"></i></div>
            <div>Входящие</div>
        </div>
        <div class="nav-button" data-page="profile-page">
            <div class="nav-icon"><i class="far fa-user"></i></div>
            <div>Профиль</div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;

            // ===================================================================
            // Инициализация Telegram SDK
            // ===================================================================
            tg.ready(); // Сообщаем Telegram, что приложение готово
            tg.expand(); // Расширяем приложение на весь экран

            const initDataUnsafe = tg.initDataUnsafe || {};
            const user = initDataUnsafe.user || {
                id: '123456789',
                first_name: 'User',
                last_name: '',
                username: `user_${Math.floor(Math.random() * 1000)}`,
            };

            // ===================================================================
            // Глобальные переменные и моковые данные
            // ===================================================================
            const mockVideos = [
                { id: 1, url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4', username: '@travel_lover', description: 'Beautiful sunset at the beach 🌅 #travel #sunset', likes: 1243, comments: 56, shares: 12 },
                { id: 2, url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4', username: '@food_explorer', description: 'Making homemade pasta from scratch 🍝 #food #cooking', likes: 876, comments: 43, shares: 8 },
                { id: 3, url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4', username: '@fitness_guru', description: 'Morning workout routine 💪 #fitness #workout', likes: 1542, comments: 87, shares: 23 },
                { id: 4, url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4', username: '@pet_lover', description: 'My cute puppy playing in the park 🐶 #pets #dogs', likes: 2310, comments: 132, shares: 45 },
                { id: 5, url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4', username: '@tech_geek', description: 'Unboxing the new smartphone 📱 #tech #gadgets', likes: 987, comments: 76, shares: 34 }
            ];
            let currentVideoIndex = 0;
            let isSwiping = false;

            // ===================================================================
            // Функции для работы с интерфейсом
            // ===================================================================

            // Форматирование чисел (1234 -> 1.2K)
            function formatNumber(num) {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            }

            // Создание HTML-элемента для видео
            function createVideoElement(videoData, classNames = '') {
                const videoWrapper = document.createElement('div');
                videoWrapper.className = `video-wrapper ${classNames}`;
                videoWrapper.dataset.videoId = videoData.id;

                videoWrapper.innerHTML = `
                    <video class="video-player" src="${videoData.url}" loop muted playsinline></video>
                    <div class="video-overlay"></div>
                    <div class="loading-indicator"><div class="spinner"></div></div>
                    <div class="video-info">
                        <div class="username">${videoData.username}</div>
                        <div class="description">${videoData.description}</div>
                    </div>
                    <div class="right-sidebar">
                        <div class="avatar">${videoData.username.charAt(1).toUpperCase()}<div class="follow-button">+</div></div>
                        <div class="action-button like-btn">
                            <i class="action-icon far fa-heart"></i>
                            <div class="action-count">${formatNumber(videoData.likes)}</div>
                        </div>
                        <div class="action-button comment-btn">
                            <i class="action-icon far fa-comment-dots"></i>
                            <div class="action-count">${formatNumber(videoData.comments)}</div>
                        </div>
                        <div class="action-button share-btn">
                            <i class="action-icon fas fa-share"></i>
                            <div class="action-count">${formatNumber(videoData.shares)}</div>
                        </div>
                    </div>
                `;

                // Обработчики событий для кнопок
                videoWrapper.querySelector('.like-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleLike(e.currentTarget);
                });
                videoWrapper.querySelector('.comment-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    tg.HapticFeedback.impactOccurred('light');
                    tg.showAlert('Комментарии скоро появятся!');
                });
                videoWrapper.querySelector('.share-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    tg.HapticFeedback.impactOccurred('light');
                    tg.showPopup({
                        title: 'Поделиться',
                        message: 'Поделиться этим видео?',
                        buttons: [
                            { id: 'share_tg', type: 'default', text: 'В Telegram' },
                            { id: 'copy_link', type: 'default', text: 'Копировать ссылку' },
                            { type: 'cancel' },
                        ]
                    }, (buttonId) => {
                        if (buttonId === 'copy_link') {
                           tg.showAlert('Ссылка скопирована (демо)');
                        } else if (buttonId === 'share_tg') {
                            tg.switchInlineQuery(`video ${videoData.id}`);
                        }
                    });
                });

                // Двойной тап для лайка
                let lastTap = 0;
                videoWrapper.addEventListener('click', (e) => {
                    const currentTime = new Date().getTime();
                    if (currentTime - lastTap < 300) {
                        toggleLike(videoWrapper.querySelector('.like-btn'), true);
                    }
                    lastTap = currentTime;
                });

                return videoWrapper;
            }

            // Переключение лайка
            function toggleLike(button, fromDoubleTap = false) {
                const icon = button.querySelector('i');
                const isLiked = icon.classList.toggle('fas');
                icon.classList.toggle('far');
                icon.classList.toggle('liked');
                
                if (fromDoubleTap) {
                    if (!isLiked) return; // Не показывать анимацию, если лайк уже стоял
                    // Анимация сердечка при двойном тапе
                    const heart = document.createElement('i');
                    heart.className = 'fas fa-heart';
                    heart.style.position = 'absolute';
                    heart.style.top = '50%';
                    heart.style.left = '50%';
                    heart.style.transform = 'translate(-50%, -50%) scale(0)';
                    heart.style.color = 'rgba(255, 255, 255, 0.8)';
                    heart.style.fontSize = '80px';
                    heart.style.transition = 'all 0.5s ease-out';
                    button.closest('.video-wrapper').appendChild(heart);
                    setTimeout(() => {
                        heart.style.transform = 'translate(-50%, -50%) scale(1)';
                        heart.style.opacity = '0';
                    }, 10);
                    setTimeout(() => heart.remove(), 500);
                }
                
                tg.HapticFeedback.impactOccurred(isLiked ? 'medium' : 'light');
            }

            // Загрузка и отображение видео в ленте
            function renderVideoFeed() {
                const videoContainer = document.getElementById('video-container');
                videoContainer.innerHTML = ''; // Очищаем контейнер

                // Создаем текущее, следующее и предыдущее видео
                const prevIndex = (currentVideoIndex - 1 + mockVideos.length) % mockVideos.length;
                const nextIndex = (currentVideoIndex + 1) % mockVideos.length;

                const prevVideo = createVideoElement(mockVideos[prevIndex], 'prev');
                const currentVideo = createVideoElement(mockVideos[currentVideoIndex], 'active');
                const nextVideo = createVideoElement(mockVideos[nextIndex], 'next');

                videoContainer.append(prevVideo, currentVideo, nextVideo);
                playCurrentVideo();
            }

            // Воспроизведение текущего видео
            function playCurrentVideo() {
                document.querySelectorAll('.video-player').forEach(v => v.pause());
                const activeVideo = document.querySelector('.video-wrapper.active .video-player');
                if (activeVideo) {
                    activeVideo.play().catch(e => console.error("Ошибка воспроизведения:", e));
                }
            }

            // Переход к следующему/предыдущему видео
            function navigateVideo(direction) {
                if (isSwiping) return;
                isSwiping = true;

                currentVideoIndex = (currentVideoIndex + direction + mockVideos.length) % mockVideos.length;
                renderVideoFeed();
                tg.HapticFeedback.impactOccurred('light');

                setTimeout(() => { isSwiping = false; }, 500); // Задержка для предотвращения быстрых свайпов
            }

            // ===================================================================
            // Навигация по приложению
            // ===================================================================
            function navigateToPage(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(pageId).classList.add('active');

                document.querySelectorAll('.nav-button').forEach(b => b.classList.remove('active'));
                const navButton = document.querySelector(`.nav-button[data-page="${pageId}"]`);
                if (navButton) navButton.classList.add('active');

                // Показываем или скрываем кнопку "Назад"
                if (pageId === 'home-page') {
                    tg.BackButton.hide();
                    playCurrentVideo();
                } else {
                    tg.BackButton.show();
                    document.querySelectorAll('.video-player').forEach(v => v.pause());
                }
                
                tg.HapticFeedback.impactOccurred('light');
            }

            // Настройка обработчиков событий навигации
            document.querySelectorAll('.nav-button').forEach(button => {
                button.addEventListener('click', () => navigateToPage(button.dataset.page));
            });

            // Обработка кнопки "Назад"
            tg.BackButton.onClick(() => {
                navigateToPage('home-page');
            });

            // ===================================================================
            // Заполнение контента
            // ===================================================================
            function populateProfile() {
                document.querySelector('.profile-avatar').textContent = (user.first_name.charAt(0) + (user.last_name?.charAt(0) || '')).toUpperCase();
                document.querySelector('.profile-name').textContent = `${user.first_name} ${user.last_name || ''}`.trim();
                document.querySelector('.profile-username').textContent = `@${user.username}`;

                const grid = document.getElementById('profile-videos-grid');
                grid.innerHTML = '';
                mockVideos.forEach(video => {
                    const item = document.createElement('div');
                    item.className = 'grid-item';
                    item.innerHTML = `<img src="https://via.placeholder.com/270x480.png/181818/181818" class="grid-item-thumbnail" alt="video thumbnail">`; // Используем заглушки
                    grid.appendChild(item);
                });
            }

            // ===================================================================
            // Обработка свайпов
            // ===================================================================
            let touchStartY = 0;
            document.getElementById('home-page').addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });

            document.getElementById('home-page').addEventListener('touchend', (e) => {
                const touchEndY = e.changedTouches[0].clientY;
                const deltaY = touchEndY - touchStartY;
                if (Math.abs(deltaY) > 50) { // Порог свайпа
                    navigateVideo(deltaY > 0 ? -1 : 1);
                }
            }, { passive: true });

            // ===================================================================
            // Первоначальный запуск
            // ===================================================================
            populateProfile();
            renderVideoFeed();
        });
    </script>
</body>
</html>
