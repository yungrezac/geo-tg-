<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guid - Short Video App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        #video-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .video-wrapper {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }
        
        .video-wrapper.active {
            display: block;
        }
        
        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #111;
        }
        
        .video-info {
            position: absolute;
            bottom: 80px;
            left: 15px;
            z-index: 10;
            max-width: 70%;
        }
        
        .username {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .description {
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .hashtags {
            font-size: 14px;
            color: #1c9eff;
        }
        
        .right-sidebar {
            position: absolute;
            right: 15px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 10;
        }
        
        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #fff;
            margin-bottom: 15px;
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
        }
        
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .action-icon {
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            font-size: 20px;
        }
        
        .action-count {
            font-size: 12px;
        }
        
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: #000;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 20;
        }
        
        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            font-size: 10px;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 3px;
        }
        
        .active {
            color: #1c9eff;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
            color: white;
            font-size: 18px;
        }
        
        .swipe-hint {
            position: absolute;
            bottom: 150px;
            width: 100%;
            text-align: center;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            z-index: 5;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            max-width: 80%;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <!-- Videos will be inserted here dynamically -->
        <div class="loading">Loading Guid...</div>
    </div>
    
    <div class="swipe-hint">Swipe up for next video</div>
    
    <div class="bottom-nav">
        <div class="nav-button active">
            <div class="nav-icon">üè†</div>
            <div>Home</div>
        </div>
        <div class="nav-button">
            <div class="nav-icon">üîç</div>
            <div>Discover</div>
        </div>
        <div class="nav-button">
            <div class="nav-icon">‚ûï</div>
            <div>Create</div>
        </div>
        <div class="nav-button">
            <div class="nav-icon">üí¨</div>
            <div>Inbox</div>
        </div>
        <div class="nav-button">
            <div class="nav-icon">üë§</div>
            <div>Profile</div>
        </div>
    </div>
    
    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        
        // Expand the app to full viewport
        tg.expand();
        
        // Get init data
        const initData = tg.initData || {};
        const initDataUnsafe = tg.initDataUnsafe || {};
        const userId = initDataUnsafe.user?.id || '123456789';
        const firstName = initDataUnsafe.user?.first_name || 'User';
        const lastName = initDataUnsafe.user?.last_name || '';
        const username = initDataUnsafe.user?.username || `user_${Math.floor(Math.random() * 1000)}`;
        
        // Mock video data with reliable test videos
        const mockVideos = [
            {
                id: 1,
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                username: '@travel_lover',
                description: 'Beautiful sunset at the beach üåÖ #travel #sunset',
                likes: 1243,
                comments: 56,
                shares: 12,
                hashtags: '#travel #sunset #beach'
            },
            {
                id: 2,
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
                username: '@food_explorer',
                description: 'Making homemade pasta from scratch üçù #food #cooking',
                likes: 876,
                comments: 43,
                shares: 8,
                hashtags: '#food #cooking #pasta'
            },
            {
                id: 3,
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                username: '@fitness_guru',
                description: 'Morning workout routine üí™ #fitness #workout',
                likes: 1542,
                comments: 87,
                shares: 23,
                hashtags: '#fitness #workout #morning'
            },
            {
                id: 4,
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
                username: '@pet_lover',
                description: 'My cute puppy playing in the park üê∂ #pets #dogs',
                likes: 2310,
                comments: 132,
                shares: 45,
                hashtags: '#pets #dogs #animals'
            },
            {
                id: 5,
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4',
                username: '@tech_geek',
                description: 'Unboxing the new smartphone üì± #tech #gadgets',
                likes: 987,
                comments: 76,
                shares: 34,
                hashtags: '#tech #gadgets #unboxing'
            }
        ];
        
        // Current video index
        let currentVideoIndex = 0;
        let isLoading = false;
        
        // Format large numbers
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }
        
        // Create video element
        function createVideoElement(videoData, isActive = false) {
            const videoWrapper = document.createElement('div');
            videoWrapper.className = `video-wrapper ${isActive ? 'active' : ''}`;
            videoWrapper.dataset.videoId = videoData.id;
            
            const videoElement = document.createElement('video');
            videoElement.className = 'video-player';
            videoElement.src = videoData.url;
            videoElement.loop = true;
            videoElement.muted = true;
            videoElement.playsInline = true;
            
            // Show loading state
            const loadingIndicator = document.createElement('div');
            loadingIndicator.className = 'loading';
            loadingIndicator.textContent = 'Loading video...';
            
            // Error handling
            const errorMessage = document.createElement('div');
            errorMessage.className = 'error-message';
            errorMessage.style.display = 'none';
            errorMessage.textContent = 'Failed to load video';
            
            videoElement.addEventListener('waiting', () => {
                loadingIndicator.style.display = 'block';
            });
            
            videoElement.addEventListener('playing', () => {
                loadingIndicator.style.display = 'none';
            });
            
            videoElement.addEventListener('error', () => {
                loadingIndicator.style.display = 'none';
                errorMessage.style.display = 'block';
            });
            
            // Video info overlay
            const videoInfo = document.createElement('div');
            videoInfo.className = 'video-info';
            videoInfo.innerHTML = `
                <div class="username">${videoData.username}</div>
                <div class="description">${videoData.description}</div>
                <div class="hashtags">${videoData.hashtags}</div>
            `;
            
            // Right sidebar actions
            const rightSidebar = document.createElement('div');
            rightSidebar.className = 'right-sidebar';
            rightSidebar.innerHTML = `
                <div class="action-button">
                    <div class="avatar">${videoData.username.charAt(1).toUpperCase()}</div>
                </div>
                <div class="action-button">
                    <div class="action-icon">‚ù§Ô∏è</div>
                    <div class="action-count">${formatNumber(videoData.likes)}</div>
                </div>
                <div class="action-button">
                    <div class="action-icon">üí¨</div>
                    <div class="action-count">${formatNumber(videoData.comments)}</div>
                </div>
                <div class="action-button">
                    <div class="action-icon">‚ÜóÔ∏è</div>
                    <div class="action-count">${formatNumber(videoData.shares)}</div>
                </div>
                <div class="action-button">
                    <div class="action-icon">üéµ</div>
                    <div class="action-count">Original</div>
                </div>
            `;
            
            videoWrapper.appendChild(videoElement);
            videoWrapper.appendChild(loadingIndicator);
            videoWrapper.appendChild(errorMessage);
            videoWrapper.appendChild(videoInfo);
            videoWrapper.appendChild(rightSidebar);
            
            return videoWrapper;
        }
        
        // Load videos
        function loadVideos() {
            if (isLoading) return;
            isLoading = true;
            
            const videoContainer = document.getElementById('video-container');
            const loadingElement = videoContainer.querySelector('.loading');
            if (loadingElement) loadingElement.remove();
            
            // Clear existing videos except the current one
            const existingWrappers = Array.from(videoContainer.querySelectorAll('.video-wrapper'));
            existingWrappers.forEach(wrapper => {
                if (wrapper.dataset.videoId !== mockVideos[currentVideoIndex].id.toString()) {
                    wrapper.remove();
                }
            });
            
            // Show current video
            let currentVideoWrapper = videoContainer.querySelector(`.video-wrapper[data-video-id="${mockVideos[currentVideoIndex].id}"]`);
            
            if (!currentVideoWrapper) {
                currentVideoWrapper = createVideoElement(mockVideos[currentVideoIndex], true);
                videoContainer.appendChild(currentVideoWrapper);
            } else {
                currentVideoWrapper.classList.add('active');
            }
            
            // Try to play the video
            const videoElement = currentVideoWrapper.querySelector('.video-player');
            videoElement.play().catch(e => {
                console.log('Autoplay prevented, showing play button:', e);
                // In a real app, you might show a play button here
            });
            
            // Preload next video
            const nextVideoIndex = (currentVideoIndex + 1) % mockVideos.length;
            let nextVideoWrapper = videoContainer.querySelector(`.video-wrapper[data-video-id="${mockVideos[nextVideoIndex].id}"]`);
            
            if (!nextVideoWrapper) {
                nextVideoWrapper = createVideoElement(mockVideos[nextVideoIndex]);
                videoContainer.appendChild(nextVideoWrapper);
                
                // Preload the next video
                const nextVideoElement = nextVideoWrapper.querySelector('.video-player');
                nextVideoElement.preload = 'auto';
            }
            
            isLoading = false;
        }
        
        // Handle swipe gestures
        let startY = 0;
        let currentY = 0;
        let isSwiping = false;
        
        document.addEventListener('touchstart', (e) => {
            startY = e.touches[0].clientY;
            currentY = startY;
            isSwiping = true;
        });
        
        document.addEventListener('touchmove', (e) => {
            if (!isSwiping) return;
            currentY = e.touches[0].clientY;
            
            // Prevent scrolling
            if (Math.abs(currentY - startY) > 10) {
                e.preventDefault();
            }
        });
        
        document.addEventListener('touchend', (e) => {
            if (!isSwiping) return;
            isSwiping = false;
            
            const deltaY = currentY - startY;
            
            // Swipe up - next video
            if (deltaY < -50) {
                const currentVideoWrapper = document.querySelector('.video-wrapper.active');
                if (currentVideoWrapper) {
                    const videoElement = currentVideoWrapper.querySelector('.video-player');
                    videoElement.pause();
                    currentVideoWrapper.classList.remove('active');
                }
                
                currentVideoIndex = (currentVideoIndex + 1) % mockVideos.length;
                loadVideos();
            }
            // Swipe down - previous video
            else if (deltaY > 50) {
                const currentVideoWrapper = document.querySelector('.video-wrapper.active');
                if (currentVideoWrapper) {
                    const videoElement = currentVideoWrapper.querySelector('.video-player');
                    videoElement.pause();
                    currentVideoWrapper.classList.remove('active');
                }
                
                currentVideoIndex = (currentVideoIndex - 1 + mockVideos.length) % mockVideos.length;
                loadVideos();
            }
        });
        
        // Handle back button
        tg.BackButton.onClick(() => {
            if (confirm('Are you sure you want to close Guid?')) {
                tg.close();
            }
        });
        
        // Show back button when not on the first screen
        tg.BackButton.show();
        
        // Main button for actions
        tg.MainButton.setParams({
            text: 'CREATE VIDEO',
            color: '#1c9eff',
            text_color: '#ffffff'
        });
        
        tg.MainButton.onClick(() => {
            tg.showAlert('Coming soon: Video creation feature!');
        });
        
        tg.MainButton.show();
        
        // Load initial videos
        loadVideos();
        
        // Send view event to Telegram
        tg.sendData(JSON.stringify({
            event: 'view_home',
            userId: userId,
            timestamp: Date.now()
        }));
    </script>
</body>
</html>
